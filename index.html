<html>
    <head>
        <title>Demo</title>
        <script src="https://cdn.jsdelivr.net/npm/@6c65726f79/custom-titlebar/lib/index.js"></script>
        <link rel="manifest" href="manifest.webmanifest">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div id="app">
            <div id="align">
                <span>
                    This is a PWA demo using <a href="https://github.com/6c65726f79/custom-titlebar" target="_blank">@6c65726f79/custom-titlebar</a>.
                </span>
                <button class="add-button">Install PWA</button>
            </div>
        </div>
        <script>
            let titlebar;
            const menu = [
                {
                    label: 'Demo',
                    submenu: [
                        {
                            label: 'Checkbox',
                            type: 'checkbox'
                        },
                        {
                            label: 'Checked state',
                            click: () => {
                                alert(menu[0].submenu.items[0].checked ? 'Checked' : 'Unchecked');
                            }
                        },
                        {
                            type:'separator'
                        },
                        {
                            label: 'Radio #1',
                            type: 'radio'
                        },
                        {
                            label: 'Radio #2',
                            type: 'radio'
                        },
                        {
                            type:'separator'
                        },
                        {
                            label: 'Radio #1',
                            type: 'radio'
                        },
                        {
                            label: 'Radio #2',
                            type: 'radio'
                        },
                        {
                            type:'separator'
                        },
                        {
                            label: 'More',
                            submenu: [
                                {
                                    label: 'Radio #1',
                                    type: 'radio',
                                    checked: true
                                },
                                {
                                    label: 'Radio #2',
                                    type: 'radio'
                                },
                                {
                                    label: 'Checked radio',
                                    click: () => {
                                        alert(`${menu[0].submenu.items[9].submenu.items.find(item => item.checked).label} checked`);
                                    }
                                },
                            ]
                        }
                    ]
                },
                {
                    label: 'Options',
                    submenu: [
                        {
                            label: 'Condensed',
                            type: 'checkbox',
                            click: () => {
                                titlebar.updateOptions({condensed:menu[1].submenu.items[0].checked});
                            }
                        },
                        {
                            label: 'Drag',
                            type: 'checkbox',
                            checked: true,
                            click: () => {
                                titlebar.updateOptions({drag:menu[1].submenu.items[1].checked});
                            }
                        },
                        {
                            label: 'Icon',
                            type: 'checkbox',
                            checked: true,
                            click: () => {
                                console.log(this);
                                titlebar.updateOptions({icon:menu[1].submenu.items[2].checked? "./img/fire-32.png" : null});
                            }
                        },
                        {
                            type:'separator'
                        },
                        {
                            label: 'Left',
                            tooltip: 'Title horizontal alignment',
                            type: 'radio',
                            click: () => {
                                titlebar.updateOptions({titleHorizontalAlignment:'left'});
                            }
                        },
                        {
                            label: 'Center',
                            tooltip: 'Title horizontal alignment',
                            type: 'radio',
                            checked: true,
                            click: () => {
                                titlebar.updateOptions({titleHorizontalAlignment:'center'});
                            }
                        },
                        {
                            label: 'Right',
                            tooltip: 'Title horizontal alignment',
                            type: 'radio',
                            click: () => {
                                titlebar.updateOptions({titleHorizontalAlignment:'right'});
                            }
                        },
                    ]
                },
                {
                    label: 'Window',
                    submenu: [
                        {
                            label: 'Back',
                            accelerator: 'Alt+Left',
                            click: () => {
                                history.back();
                            }
                        },
                        {
                            label: 'Forward',
                            accelerator: 'Alt+Right',
                            click: () => {
                                history.forward();
                            }
                        },
                        {
                            label: 'Reload',
                            accelerator: 'Ctrl+R',
                            click: () => {
                                window.location = window.location;
                            }
                        },
                        {
                            label: 'Close',
                            accelerator: 'Ctrl+W',
                            click: () => {
                                window.close();
                            }
                        },
                        {
                            type:'separator'
                        },
                        {
                            label: 'Print...',
                            accelerator: 'Ctrl+P',
                            click: () => {
                                window.print()
                            }
                        },
                        {
                            type:'separator'
                        },
                        {
                            label: 'Fullscreen',
                            accelerator: 'F11',
                            click: () => {
                                document.body.requestFullscreen();
                            }
                        },

                    ]
                }
            ];

            window.addEventListener("load", () => {
                if (navigator.standalone || window.matchMedia('(display-mode: standalone)').matches) {
                    createTitlebar()
                }
            });

            window.matchMedia('(display-mode: standalone)').onchange = (e) => {
                e.matches ? createTitlebar() : titlebar.dispose();
            }

            function createTitlebar() {
                titlebar = new Titlebar({
                    backgroundUnfocusEffect: false,
                    windowControlsOverlay: true,
                    backgroundColor:"#2975ff",
                    icon: "./img/fire-32.png",
                    menu
                });
            }
        </script>
        <script>
            let deferredPrompt;
            const addBtn = document.querySelector('.add-button');
            addBtn.style.display = 'none';
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                addBtn.style.display = 'block';
              
                addBtn.addEventListener('click', (e) => {
                    addBtn.style.display = 'none';
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the A2HS prompt');
                        } else {
                            console.log('User dismissed the A2HS prompt');
                        }
                        deferredPrompt = null;
                    });
                });
            });

            // Register a Service Worker to enable PWA
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", async () => {
                    await navigator.serviceWorker.register("sw.js");
                });
            }
        </script>
    </body>
</html>